<!DOCTYPE html>
<html>
<body>

<h2>FCL Vanilla</h2>



<div>
	<button onclick="getLatestBlock()" >Get Latest Block </button>
	<div id='blockResponse'></div>
</div>

<br/><br/>

<div>
	<input id='account' value='5555a83349295167' placeholder="Enter Flow address">
	<button onclick="getAccount()" >Lookup Account </button>
	<div id='getAccounResponse'></div>
</div>

<br/><br/>


<div>
	<textarea id='script'>
		pub fun main(): Int {
 			 return 42 + 6
		}
	</textarea>
	<button onclick="runScript()" >Run Script</button>
	<div id='runScriptResponse'></div>
</div>


<br/><br/>


<div>
	
	<button onclick="fcl.authenticate()" >Login</button>
	<button onclick="fcl.unauthenticate()" >Logout</button>

	<div id='loginResponse'></div>
</div>


<br/><br/>

<div>
	<textarea id='transaction'>
transaction {
  prepare(signer: AuthAccount) {

        var acc = AuthAccount(payer: signer);
        acct.addPublicKey("c1fe894c80a9d9a6e8f93e39afd8c0cdefad75a2ad2309174e55438bb9a6bd66818730e8c8889251303c7d4433668790175801b5a21b4e5d3ae0d25637d104b3".decodeHex())
  }
}
    </textarea>
	<button onclick="sendTransaction()" >Send Transaction</button>
	<div id='sendTransactionResponse'></div>
    


</div>


<script src="sdk.js"></script>

<script>
fcl.config()
  .put("accessNode.api", "https://access-mainnet-beta.onflow.org")
  .put("challenge.handshake", "https://flow-wallet.blocto.app/authn") 


fcl.currentUser().subscribe(user => showUser({...user}))

var showUser = function(user){
	console.log(user);
	
	    document.getElementById('loginResponse').innerText = JSON.stringify(user);
}
var getLatestBlock = async function() {
    const response = await fcl.send([
      fcl.getLatestBlock(),
    ]);
    var r  = await fcl.decode(response);
    document.getElementById('blockResponse').innerText = JSON.stringify(r);
}

var getAccount = async function() {
    const response = await fcl.send([
      fcl.getAccount(document.getElementById('account').value),
    ]);
    var r  = await fcl.decode(response);
    document.getElementById('getAccounResponse').innerText = JSON.stringify(r);
}

var runScript = async function() {
    const response = await fcl.send([
      fcl.script(document.getElementById('script').value),
    ]);
    var r  = await fcl.decode(response);
    document.getElementById('runScriptResponse').innerText = JSON.stringify(r);
}

var setStatus = function(status){
    document.getElementById('sendTransactionResponse').innerText = status;
}

var sendTransaction = async function() {
    const response = await fcl.send([
      fcl.script(document.getElementById('script').value),
    ]);

    setStatus("Resolving...")

    const blockResponse = await fcl.send([
      fcl.getLatestBlock(),
    ])

    const block = await fcl.decode(blockResponse)

    try {
      const { transactionId } = await fcl.send([
        fcl.transaction(document.getElementById('transaction').value),
        fcl.proposer(fcl.currentUser().authorization),
        fcl.payer(fcl.currentUser().authorization),
        fcl.authorizations([fcl.currentUser().authorization]),
        fcl.ref(block.id),
        fcl.limit(9999),
      ])

      setStatus("Transaction sent, waiting for confirmation")

      const unsub = fcl
        .tx({ transactionId })
        .subscribe(transaction => {

          if (fcl.tx.isSealed(transaction)) {
            setStatus("Transaction is Sealed:" + transactionId)
            unsub()
          }
        })
    } catch (error) {
      console.error(error);
      setStatus("Transaction failed")
    }
 }


</script>

</body>
</html> 
